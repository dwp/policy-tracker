{% extends prototype.current.layout %}

{% set page = {
  title: 'index',
  dev: true,
  html_classes: ['full-width']
} %}

{% block portfolio_projects %}
  
  <div class="grid">
    <div class="grid__item one-half">
      <h2 class="heading-large js-directorate-label" style="margin: 0 0 20px 0">All directorates</h2>
    </div>
    <div class="grid__item one-half ta--right">
      <div class="portfolio-sort">
        <label class="portfolio-sort__label" for="sort-select">Sort by </label>
        <select class="form-control portfolio-sort__select js-sort-select" id="sort-select">
          <option value="original-order">Choose</option>
          <option value="priority">By Priority</option>
          <option value="date">By Date</option>
          <option value="name">By title</option>
          <option value="status">By Status</option>
          <option value="random">Random</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="grid js-projects-grid">
      
      {% set projectsData = [
        {
          title: 'ESA Programme',
          description: 'A series of work strands to reform ESA interal assessment centres, business transformation...',
          director: 'Justin Russell',
          directorate: 'Disability Employment Support',
          status: 'open',
          priority: 1,
          metadata: {
            classes: [
              'directorate-1',
              'priority-1',
              'minister-1',
              'status-open',
              'type-1',
              'trigger-1'
            ]
          }
        },
        {
          title: 'ESA Work Related Activity Component removal',
          description: 'Removal of WRA components of ESA.',
          director: 'Justin Russell',
          directorate: 'Disability Employment Support',
          priority: 2,
          duedate: '10 Aug 2016',
          status: 'scoping',
          metadata: {
            classes: [
              'directorate-1',
              'priority-2',
              'minister-2',
              'status-scoping',
              'type-2',
              'trigger-2'
            ]
          }
        },
        {
          title: 'Pension Reform 2',
          description: 'Allocating the equalisation of State Pension Age and extending SPA to 66 more quickly.',
          director: 'Mary Pattison & Charlotte Clark',
          directorate: 'State Pensions Aging Society',
          priority: 3,
          status: 'In development',
          duedate: '25 Jan 2017',
          metadata: {
            classes: [
              'directorate-1',
              'priority-3',
              'minister-3',
              'status-development',
              'type-3',
              'trigger-3'
            ]
          }
        },
        {
          title: 'State Pension TopUp',
          description: 'Enabling people to increase State Pension Entitlement through purchase of additional voluntary NI contributions.',
          priority: 4,
          status: 'Awaiting decision',
          directorate: 'State Pensions Aging Society',
          director: 'Mary Pattison & Charlotte Clark',
          duedate: '17 Sep 2018',
          metadata: {
            classes: [
              'directorate-4',
              'priority-4',
              'minister-4',
              'status-decision',
              'type-4',
              'trigger-4'
            ]
          }
        },
        {
          title: 'Personal Independance Programme',
          description: 'A new objective assessment for working age customers and re-assessment of existing DLA recipients.',
          priority: 5,
          status: 'open',
          director: 'Sue Moore',
          directorate: 'PIP',
          metadata: {
            classes: [
              'directorate-11',
              'priority-5',
              'minister-5',
              'status-open',
              'type-5',
              'trigger-5'
            ]
          }
        },
        {
          title: 'Automatic Enrolment Programme',
          description: 'A programme which requires employers to automatically enroll employees into a qualifying workplace pension.',
          directorate: 'State Pensions Aging Society',
          director: 'Charlotte Clark',
          priority: 5,
          metadata: {
            classes: [
              'directorate-6',
              'priority-5',
              'minister-2',
              'status-development',
              'type-2',
              'trigger-3'
            ]
          }
        },
        {
          title: 'Scottish Devolution Programme',
          description: 'Implementing the Smith Commission Wealthfare recommendations for DWP - devolution of benefit and services...',
          priority: 2,
          directorate: 'Devolution',
          director: 'Richard Cornish',
          metadata: {
            classes: [
              'directorate-7',
              'priority-2',
              'minister-3',
              'status-closed',
              'type-3',
              'trigger-4'
            ]
          }
        } 
      ] %}
      
      {% for project in projectsData %}
        {{ portfolio.project_item(project) }}
      {% endfor %}
      
  </div>
{% endblock %}

{% block portfolio_filters %}
  <div class="portfolio-filters">
    
    <h2 class="heading-medium" style="margin: 0 0 20px 0;">Filter the portfolio</h2>
    <p>Use the facets below to refine your view of the portfolio</p>
    
    <div class="portfolio-filters__facet">
      <label class="portfolio-filters__facet__title heading-small" style="display: block" for="facet-directorate">Directorate</label>
      <select class="form-control portfolio-filters__select js-filter-action js-filter-directorate" id="facet-directorate">
        <option value="directorate-all">All directorates</option>
        <option value="directorate-1">Health & Work</option>
        <option value="directorate-2">State pensions ageing society</option>
        <option value="directorate-3">Working age benefit</option>
        <option value="directorate-4">Analytical services</option>
        <option value="directorate-5">Children, Families & Disadvantage</option>
        <option value="directorate-6">Labour market, EU & International affairs</option>
        <option value="directorate-8">Disability employment support</option>
        <option value="directorate-9">Devolution</option>
        <option value="directorate-10">Strategic Health & Science</option>
        <option value="directorate-11">Personal Independance Payment</option>
      </select>
    </div>
    
    <div class="portfolio-filters__facet">
      <h3 class="portfolio-filters__facet__title heading-small">Type</h3>
      <div class="portfolio-filters__facet">
        <label for="facet-type-1">
          <input id="facet-type-1" name="types" type="checkbox" value="type-1" class="js-filter-action">
          White & Green papers
        </label>
      </div>
      <div class="portfolio-filters__facet">
        <label for="facet-type-2">
          <input id="facet-type-2" name="types" type="checkbox" value="type-2" class="js-filter-action">
          Legislation
        </label>
      </div>
      <div class="portfolio-filters__facet">
        <label for="facet-type-3">
          <input id="facet-type-3" name="types" type="checkbox" value="type-3" class="js-filter-action">
          Support / Advice
        </label>
      </div>
    </div>
    
    <div class="portfolio-filters__facet">
      <label class="portfolio-filters__facet__title heading-small" style="display: block" for="facet-minister">Minister</label>
      <select class="form-control portfolio-filters__select js-filter-action" id="facet-minister">
        <option value="minister-all">All ministers</option>
        <option value="minister-1">Secretary of State</option>
        <option value="minister-2">Secretary of State for Justice</option>
        <option value="minister-3">Leader of the House of Commons</option>
      </select>
    </div>
    
    <div class="portfolio-filters__facet">
      <label class="portfolio-filters__facet__title heading-small" style="display: block" for="facet-trigger">Trigger</label>
      <select class="form-control portfolio-filters__select js-filter-action" id="facet-trigger">
        <option value="trigger-all">All triggers</option>
        <option value="trigger-1">Minsiter</option>
        <option value="trigger-2">No. 10</option>
        <option value="trigger-3">Arms length body</option>
        <option value="trigger-4">Legislation</option>
        <option value="trigger-5">EU</option>
        <option value="trigger-6">Legal / Court Rulings</option>
        <option value="trigger-7">Treasury</option>
      </select>
    </div>
    
    <div class="portfolio-filters__facet">
      <label class="portfolio-filters__facet__title heading-small" style="display: block" for="facet-status">Status</label>
      <select class="form-control portfolio-filters__select js-filter-action" id="facet-status">
        <option value="status-all">All statuses</option>
        <option value="status-open">Open</option>
        <option value="status-scoping">Scoping</option>
        <option value="status-resourcing">Resourcing</option>
        <option value="status-development">in development</option>
        <option value="status-decision">Awaiting decision</option>
        <option value="status-closed">Closed</option>
      </select>
    </div>
    
  </div>
{% endblock %}

{% block body_end %}
  
  <script src="{{ asset_path }}javascripts/jquery-1.11.3.js" type="text/javascript"></script>
  <script src="{{ asset_path }}javascripts/isotope.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    $(function(){
      
      var pp = {
        
        handleFilterActions: function() {
          var self = this;
          var $filterActions = $('.js-filter-action');
          var actionString;
          
          if($filterActions.length) {
            
            $filterActions.on('change', function(){
              
              actionString = '';
              
              $filterActions.each(function(i){
                var $thisFilter = $(this);
                if($thisFilter.is('input[type="checkbox"]')) {
                  if($thisFilter.is(":checked")) {
                    actionString += '.' + $thisFilter.val() ;
                  }
                } else {
                  actionString += '.' + $thisFilter.val();
                }
              });
              
              self.grid.isotope({ filter: actionString });
              
            }); 
            
          }
        },
        
        grid: $('.js-projects-grid').isotope({
          itemSelector: '.js-project-item',
          layoutMode: 'fitRows',
          percentPosition: true,
          getSortData: {
            name: '.project-item__title', // text from querySelector
            priority: '.project-item__priority__rating',
            status: '.project-item__metadata__status__title',
            date: '.project-item__metadata__list__date'
          }
        }),
        
        handleDirectorateChange: function() {
          var self = this;
          var $directorateSelect = $('.js-filter-directorate');
          var $directorateLabel = $('.js-directorate-label');
          if($directorateSelect.length) {
              
            $directorateSelect.on("change", function(e){
              var $this = $(this);
              $directorateLabel.text($this.find(":selected").text());
            });
            
          }
        },
        
        handleProjects: function() {
          var self = this;
          var $projects = $('.project-item');
          if($projects.length) {
            
            $projects.each(function(){
              var $thisProject = $(this);
              $thisProject.on('click', function(e){
                // var projectURL = $thisProject.attr('data-detail-url');
                self.grid.isotope({ filter: actionString });
                
              });
            });
            
          }
        },
        
        handleSorting: function() {
          
          var self = this;
          $sorter = $('.js-sort-select');
          if($sorter.length){
            $sorter.on('change', function(e){
                self.grid.isotope({ sortBy: $(this).val() });
            });  
          }
        },
        
        init: function() {
          var self = this;
          self.handleFilterActions();
          self.handleDirectorateChange();
          self.handleProjects();
          self.handleSorting();
        }
        
      }
      
      pp.init();
      
    });
  </script>
{% endblock %}